<div class="category-header">
    <h1>Careers</h1>
    <button id="add-post-btn" class="admin-only" style="display: none;">+</button>
</div>
<div id="posts-container"></div>
<div id="post-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2></h2>
        <input type="hidden" id="post-id">
        <input type="text" id="title" placeholder="Title">
        <textarea id="content" placeholder="Content" rows="10"></textarea>
        <button id="save-post-btn">Save</button>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const isAdmin = sessionStorage.getItem('isAdmin') === 'true';
        if (isAdmin) {
            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
        }
    });

    const modal = document.getElementById('post-modal');
    const addPostBtn = document.getElementById('add-post-btn');
    const closeBtn = document.querySelector('.close-btn');
    const savePostBtn = document.getElementById('save-post-btn');

    addPostBtn.onclick = () => {
        modal.querySelector('h2').textContent = 'Create New Post';
        document.getElementById('post-id').value = '';
        document.getElementById('title').value = '';
        document.getElementById('content').value = '';
        modal.style.display = 'block';
    };

    closeBtn.onclick = () => {
        modal.style.display = 'none';
    };

    window.onclick = (event) => {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    };

    savePostBtn.onclick = async () => {
        const id = document.getElementById('post-id').value;
        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;
        const category = 'careers';

        if (title && content) {
            const post = { title, content, category };
            if (id) {
                post.id = id;
                await fetch(`/api/posts/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(post)
                });
            } else {
                await fetch('/api/posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(post)
                });
            }
            modal.style.display = 'none';
            fetchPosts();
        } else {
            alert('Please fill out all fields.');
        }
    };

    let posts = [];

    async function fetchPosts() {
        try {
            const response = await fetch('/api/posts');
            posts = await response.json();
            const careersPosts = posts.filter(post => post.category === 'careers');
            const postsContainer = document.getElementById('posts-container');
            postsContainer.innerHTML = '';
            careersPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.innerHTML = `
                    <h2>${post.title}</h2>
                    <p>${post.content}</p>
                    <div class="admin-only" style="display: none;">
                        <button onclick="editPost('${post.id}')">Edit</button>
                        <button onclick="deletePost('${post.id}')">Delete</button>
                    </div>
                `;
                postsContainer.appendChild(postElement);
            });
            if (sessionStorage.getItem('isAdmin') === 'true') {
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
            }
        } catch (error) {
            console.error('Error fetching posts:', error);
        }
    }

    window.editPost = (id) => {
        const post = posts.find(p => p.id === id);
        modal.querySelector('h2').textContent = 'Edit Post';
        document.getElementById('post-id').value = post.id;
        document.getElementById('title').value = post.title;
        document.getElementById('content').value = post.content;
        modal.style.display = 'block';
    }

    window.deletePost = async (id) => {
        if (confirm('Are you sure you want to delete this post?')) {
            await fetch(`/api/posts/${id}`, { method: 'DELETE' });
            fetchPosts();
        }
    }

    fetchPosts();
</script>
